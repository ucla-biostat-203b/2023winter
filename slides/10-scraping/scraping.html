<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Hua Zhou @ UCLA">
<meta name="dcterms.date" content="2023-02-07">

<title>Web Scraping</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="scraping_files/libs/clipboard/clipboard.min.js"></script>
<script src="scraping_files/libs/quarto-html/quarto.js"></script>
<script src="scraping_files/libs/quarto-html/popper.min.js"></script>
<script src="scraping_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="scraping_files/libs/quarto-html/anchor.min.js"></script>
<link href="scraping_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="scraping_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="scraping_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="scraping_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="scraping_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#web-scraping" id="toc-web-scraping" class="nav-link active" data-scroll-target="#web-scraping"><span class="toc-section-number">1</span>  Web scraping</a></li>
  <li><a href="#rvest" id="toc-rvest" class="nav-link" data-scroll-target="#rvest"><span class="toc-section-number">2</span>  rvest</a></li>
  <li><a href="#example-scraping-from-webpage" id="toc-example-scraping-from-webpage" class="nav-link" data-scroll-target="#example-scraping-from-webpage"><span class="toc-section-number">3</span>  Example: Scraping from webpage</a>
  <ul>
  <li><a href="#rank" id="toc-rank" class="nav-link" data-scroll-target="#rank"><span class="toc-section-number">3.1</span>  Rank</a></li>
  <li><a href="#title" id="toc-title" class="nav-link" data-scroll-target="#title"><span class="toc-section-number">3.2</span>  Title</a></li>
  <li><a href="#description" id="toc-description" class="nav-link" data-scroll-target="#description"><span class="toc-section-number">3.3</span>  Description</a></li>
  <li><a href="#runtime" id="toc-runtime" class="nav-link" data-scroll-target="#runtime"><span class="toc-section-number">3.4</span>  Runtime</a></li>
  <li><a href="#genre" id="toc-genre" class="nav-link" data-scroll-target="#genre"><span class="toc-section-number">3.5</span>  Genre</a></li>
  <li><a href="#rating" id="toc-rating" class="nav-link" data-scroll-target="#rating"><span class="toc-section-number">3.6</span>  Rating</a></li>
  <li><a href="#votes" id="toc-votes" class="nav-link" data-scroll-target="#votes"><span class="toc-section-number">3.7</span>  Votes</a></li>
  <li><a href="#director" id="toc-director" class="nav-link" data-scroll-target="#director"><span class="toc-section-number">3.8</span>  Director</a></li>
  <li><a href="#actor" id="toc-actor" class="nav-link" data-scroll-target="#actor"><span class="toc-section-number">3.9</span>  Actor</a></li>
  <li><a href="#metascore" id="toc-metascore" class="nav-link" data-scroll-target="#metascore"><span class="toc-section-number">3.10</span>  Metascore</a></li>
  <li><a href="#gross" id="toc-gross" class="nav-link" data-scroll-target="#gross"><span class="toc-section-number">3.11</span>  Gross</a></li>
  <li><a href="#visualizing-movie-data" id="toc-visualizing-movie-data" class="nav-link" data-scroll-target="#visualizing-movie-data"><span class="toc-section-number">3.12</span>  Visualizing movie data</a></li>
  </ul></li>
  <li><a href="#example-scraping-finance-data" id="toc-example-scraping-finance-data" class="nav-link" data-scroll-target="#example-scraping-finance-data"><span class="toc-section-number">4</span>  Example: Scraping finance data</a></li>
  <li><a href="#example-pull-tweets-into-r" id="toc-example-pull-tweets-into-r" class="nav-link" data-scroll-target="#example-pull-tweets-into-r"><span class="toc-section-number">5</span>  Example: Pull tweets into R</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Web Scraping</h1>
<p class="subtitle lead">Biostat 203B</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Hua Zhou @ UCLA </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 7, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>Display machine information for reproducibility.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.2 (2022-10-31)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Big Sur ... 10.16

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
 [1] digest_0.6.30     lifecycle_1.0.3   jsonlite_1.8.4    magrittr_2.0.3   
 [5] evaluate_0.18     rlang_1.0.6       stringi_1.7.8     cli_3.4.1        
 [9] rstudioapi_0.14   vctrs_0.5.1       rmarkdown_2.18    tools_4.2.2      
[13] stringr_1.5.0     glue_1.6.2        htmlwidgets_1.6.0 xfun_0.35        
[17] yaml_2.3.6        fastmap_1.1.0     compiler_4.2.2    htmltools_0.5.4  
[21] knitr_1.41       </code></pre>
</div>
</div>
<p>Load tidyverse and other packages for this lecture.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rvest"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"quantmod"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="web-scraping" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="web-scraping"><span class="header-section-number">1</span> Web scraping</h2>
<p>There is a wealth of data on internet. How to scrape them and analyze them?</p>
</section>
<section id="rvest" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="rvest"><span class="header-section-number">2</span> rvest</h2>
<p><a href="https://github.com/hadley/rvest">rvest</a> is an R package written by Hadley Wickham which makes web scraping easy.</p>
</section>
<section id="example-scraping-from-webpage" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="example-scraping-from-webpage"><span class="header-section-number">3</span> Example: Scraping from webpage</h2>
<ul>
<li><p>We follow instructions in a <a href="https://www.analyticsvidhya.com/blog/2017/03/beginners-guide-on-web-scraping-in-r-using-rvest-with-hands-on-knowledge/">Blog by SAURAV KAUSHIK</a> to find the most popular feature films of 2020.</p></li>
<li><p>Install the <a href="https://selectorgadget.com/">SelectorGadget</a> extension for Chrome.</p></li>
<li><p>The 100 most popular feature films released in 2021 can be accessed at page <a href="https://www.imdb.com/search/title/?title_type=feature&amp;release_date=2020-01-01,2020-12-31&amp;count=100" class="uri">https://www.imdb.com/search/title/?title_type=feature&amp;release_date=2020-01-01,2020-12-31&amp;count=100</a>.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifying the url for desired website to be scraped</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.imdb.com/search/title/?title_type=feature&amp;release_date=2020-01-01,2020-12-31&amp;count=100"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading the HTML code from the website</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>(webpage <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{html_document}
&lt;html xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml"&gt;
[1] &lt;head&gt;\n&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8 ...
[2] &lt;body id="styleguide-v2" class="fixed"&gt;\n            &lt;img height="1" widt ...</code></pre>
</div>
</div>
<ul>
<li>Suppose we want to scrape following 11 features from this page:
<ul>
<li>Rank</li>
<li>Title</li>
<li>Description</li>
<li>Runtime</li>
<li>Genre</li>
<li>Rating</li>
<li>Metascore</li>
<li>Votes</li>
<li>Gross_Eerning_in_Mil</li>
<li>Director</li>
<li>Actor</li>
</ul></li>
</ul>
<p align="center">
<img src="./imdb.png" height="350">
</p>
<section id="rank" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="rank"><span class="header-section-number">3.1</span> Rank</h3>
<ul>
<li>Use SelectorGadget to highlight the element we want to scrape</li>
</ul>
<p align="center">
<img src="./selectorgadget.png" height="350">
</p>
<ul>
<li>Use the CSS selector to get the rankings</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use CSS selectors to scrap the rankings section</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>(rank_data_html <span class="ot">&lt;-</span> <span class="fu">html_nodes</span>(webpage, <span class="st">'.text-primary'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (100)}
 [1] &lt;span class="lister-item-index unbold text-primary"&gt;1.&lt;/span&gt;
 [2] &lt;span class="lister-item-index unbold text-primary"&gt;2.&lt;/span&gt;
 [3] &lt;span class="lister-item-index unbold text-primary"&gt;3.&lt;/span&gt;
 [4] &lt;span class="lister-item-index unbold text-primary"&gt;4.&lt;/span&gt;
 [5] &lt;span class="lister-item-index unbold text-primary"&gt;5.&lt;/span&gt;
 [6] &lt;span class="lister-item-index unbold text-primary"&gt;6.&lt;/span&gt;
 [7] &lt;span class="lister-item-index unbold text-primary"&gt;7.&lt;/span&gt;
 [8] &lt;span class="lister-item-index unbold text-primary"&gt;8.&lt;/span&gt;
 [9] &lt;span class="lister-item-index unbold text-primary"&gt;9.&lt;/span&gt;
[10] &lt;span class="lister-item-index unbold text-primary"&gt;10.&lt;/span&gt;
[11] &lt;span class="lister-item-index unbold text-primary"&gt;11.&lt;/span&gt;
[12] &lt;span class="lister-item-index unbold text-primary"&gt;12.&lt;/span&gt;
[13] &lt;span class="lister-item-index unbold text-primary"&gt;13.&lt;/span&gt;
[14] &lt;span class="lister-item-index unbold text-primary"&gt;14.&lt;/span&gt;
[15] &lt;span class="lister-item-index unbold text-primary"&gt;15.&lt;/span&gt;
[16] &lt;span class="lister-item-index unbold text-primary"&gt;16.&lt;/span&gt;
[17] &lt;span class="lister-item-index unbold text-primary"&gt;17.&lt;/span&gt;
[18] &lt;span class="lister-item-index unbold text-primary"&gt;18.&lt;/span&gt;
[19] &lt;span class="lister-item-index unbold text-primary"&gt;19.&lt;/span&gt;
[20] &lt;span class="lister-item-index unbold text-primary"&gt;20.&lt;/span&gt;
...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the ranking data to text</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>(rank_data <span class="ot">&lt;-</span> <span class="fu">html_text</span>(rank_data_html))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "1."   "2."   "3."   "4."   "5."   "6."   "7."   "8."   "9."   "10." 
 [11] "11."  "12."  "13."  "14."  "15."  "16."  "17."  "18."  "19."  "20." 
 [21] "21."  "22."  "23."  "24."  "25."  "26."  "27."  "28."  "29."  "30." 
 [31] "31."  "32."  "33."  "34."  "35."  "36."  "37."  "38."  "39."  "40." 
 [41] "41."  "42."  "43."  "44."  "45."  "46."  "47."  "48."  "49."  "50." 
 [51] "51."  "52."  "53."  "54."  "55."  "56."  "57."  "58."  "59."  "60." 
 [61] "61."  "62."  "63."  "64."  "65."  "66."  "67."  "68."  "69."  "70." 
 [71] "71."  "72."  "73."  "74."  "75."  "76."  "77."  "78."  "79."  "80." 
 [81] "81."  "82."  "83."  "84."  "85."  "86."  "87."  "88."  "89."  "90." 
 [91] "91."  "92."  "93."  "94."  "95."  "96."  "97."  "98."  "99."  "100."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn into numerical values</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>(rank_data <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(rank_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18
 [19]  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36
 [37]  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54
 [55]  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72
 [73]  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90
 [91]  91  92  93  94  95  96  97  98  99 100</code></pre>
</div>
</div>
</section>
<section id="title" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="title"><span class="header-section-number">3.2</span> Title</h3>
<ul>
<li>Use SelectorGadget to find the CSS selector <code>.lister-item-header a</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using CSS selectors to scrap the title section</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>(title_data_html <span class="ot">&lt;-</span> <span class="fu">html_nodes</span>(webpage, <span class="st">'.lister-item-header a'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (100)}
 [1] &lt;a href="/title/tt6723592/?ref_=adv_li_tt"&gt;Tenet&lt;/a&gt;
 [2] &lt;a href="/title/tt5918982/?ref_=adv_li_tt"&gt;Possessor&lt;/a&gt;
 [3] &lt;a href="/title/tt7923220/?ref_=adv_li_tt"&gt;Inheritance&lt;/a&gt;
 [4] &lt;a href="/title/tt7628504/?ref_=adv_li_tt"&gt;Megan&lt;/a&gt;
 [5] &lt;a href="/title/tt10886166/?ref_=adv_li_tt"&gt;365 Days&lt;/a&gt;
 [6] &lt;a href="/title/tt7126948/?ref_=adv_li_tt"&gt;Wonder Woman 1984&lt;/a&gt;
 [7] &lt;a href="/title/tt10344522/?ref_=adv_li_tt"&gt;Four Good Days&lt;/a&gt;
 [8] &lt;a href="/title/tt10272386/?ref_=adv_li_tt"&gt;The Father&lt;/a&gt;
 [9] &lt;a href="/title/tt7846844/?ref_=adv_li_tt"&gt;Enola Holmes&lt;/a&gt;
[10] &lt;a href="/title/tt9620292/?ref_=adv_li_tt"&gt;Promising Young Woman&lt;/a&gt;
[11] &lt;a href="/title/tt8503618/?ref_=adv_li_tt"&gt;Hamilton&lt;/a&gt;
[12] &lt;a href="/title/tt8332922/?ref_=adv_li_tt"&gt;A Quiet Place Part II&lt;/a&gt;
[13] &lt;a href="/title/tt7395114/?ref_=adv_li_tt"&gt;The Devil All the Time&lt;/a&gt;
[14] &lt;a href="/title/tt2222042/?ref_=adv_li_tt"&gt;Love and Monsters&lt;/a&gt;
[15] &lt;a href="/title/tt9340860/?ref_=adv_li_tt"&gt;Let Him Go&lt;/a&gt;
[16] &lt;a href="/title/tt7939766/?ref_=adv_li_tt"&gt;I'm Thinking of Ending Things ...
[17] &lt;a href="/title/tt10288566/?ref_=adv_li_tt"&gt;Another Round&lt;/a&gt;
[18] &lt;a href="/title/tt9214832/?ref_=adv_li_tt"&gt;Emma.&lt;/a&gt;
[19] &lt;a href="/title/tt1502397/?ref_=adv_li_tt"&gt;Bad Boys for Life&lt;/a&gt;
[20] &lt;a href="/title/tt10919380/?ref_=adv_li_tt"&gt;Freaky&lt;/a&gt;
...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting the title data to text</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>(title_data <span class="ot">&lt;-</span> <span class="fu">html_text</span>(title_data_html))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "Tenet"                                          
  [2] "Possessor"                                      
  [3] "Inheritance"                                    
  [4] "Megan"                                          
  [5] "365 Days"                                       
  [6] "Wonder Woman 1984"                              
  [7] "Four Good Days"                                 
  [8] "The Father"                                     
  [9] "Enola Holmes"                                   
 [10] "Promising Young Woman"                          
 [11] "Hamilton"                                       
 [12] "A Quiet Place Part II"                          
 [13] "The Devil All the Time"                         
 [14] "Love and Monsters"                              
 [15] "Let Him Go"                                     
 [16] "I'm Thinking of Ending Things"                  
 [17] "Another Round"                                  
 [18] "Emma."                                          
 [19] "Bad Boys for Life"                              
 [20] "Freaky"                                         
 [21] "Birds of Prey"                                  
 [22] "The Forgotten Battle"                           
 [23] "Nomadland"                                      
 [24] "Palm Springs"                                   
 [25] "The Dry"                                        
 [26] "Extraction"                                     
 [27] "Soul"                                           
 [28] "After We Collided"                              
 [29] "The Old Guard"                                  
 [30] "Come Play"                                      
 [31] "The Babysitter: Killer Queen"                   
 [32] "Greenland"                                      
 [33] "The Hunt"                                       
 [34] "The Midnight Sky"                               
 [35] "Ava"                                            
 [36] "Mulan"                                          
 [37] "Underwater"                                     
 [38] "Greyhound"                                      
 [39] "Black Bear"                                     
 [40] "The Empty Man"                                  
 [41] "Pieces of a Woman"                              
 [42] "Run"                                            
 [43] "The Night House"                                
 [44] "Sonic the Hedgehog"                             
 [45] "The Rental"                                     
 [46] "We Can Be Heroes"                               
 [47] "The Invisible Man"                              
 [48] "The Courier"                                    
 [49] "You Should Have Left"                           
 [50] "The New Mutants"                                
 [51] "Monster Hunter"                                 
 [52] "The Woman in the Window"                        
 [53] "Eurovision Song Contest: The Story of Fire Saga"
 [54] "Wild Mountain Thyme"                            
 [55] "The King of Staten Island"                      
 [56] "The Tax Collector"                              
 [57] "The Wrong Missy"                                
 [58] "The Trial of the Chicago 7"                     
 [59] "I Care a Lot"                                   
 [60] "The Craft: Legacy"                              
 [61] "Boss Level"                                     
 [62] "Unhinged"                                       
 [63] "Mank"                                           
 [64] "Project Power"                                  
 [65] "The Croods: A New Age"                          
 [66] "Becky"                                          
 [67] "The F**k-It List"                               
 [68] "Spenser Confidential"                           
 [69] "Shiva Baby"                                     
 [70] "Big Boys Don't Cry"                             
 [71] "The Call"                                       
 [72] "Rebecca"                                        
 [73] "The Call of the Wild"                           
 [74] "The Witches"                                    
 [75] "The Duke"                                       
 [76] "Minari"                                         
 [77] "Demon Slayer the Movie: Mugen Train"            
 [78] "Onward"                                         
 [79] "Alone"                                          
 [80] "Host"                                           
 [81] "Dolittle"                                       
 [82] "Songbird"                                       
 [83] "Hubie Halloween"                                
 [84] "Trolls World Tour"                              
 [85] "2 Hearts"                                       
 [86] "Riders of Justice"                              
 [87] "News of the World"                              
 [88] "All the Bright Places"                          
 [89] "Borat Subsequent Moviefilm"                     
 [90] "Horizon Line"                                   
 [91] "Run Sweetheart Run"                             
 [92] "Fantasy Island"                                 
 [93] "Ammonite"                                       
 [94] "Eat Wheaties!"                                  
 [95] "Holidate"                                       
 [96] "The Comeback Trail"                             
 [97] "#Alive"                                         
 [98] "Lost Girls and Love Hotels"                     
 [99] "Nowhere Special"                                
[100] "Hillbilly Elegy"                                </code></pre>
</div>
</div>
</section>
<section id="description" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="description"><span class="header-section-number">3.3</span> Description</h3>
<ul>
<li></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using CSS selectors to scrap the description section</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>(description_data_html <span class="ot">&lt;-</span> <span class="fu">html_nodes</span>(webpage, <span class="st">'.ratings-bar+ .text-muted'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (100)}
 [1] &lt;p class="text-muted"&gt;\nArmed with only one word, Tenet, and fighting fo ...
 [2] &lt;p class="text-muted"&gt;\nAn agent works for a secretive organization that ...
 [3] &lt;p class="text-muted"&gt;\nThe patriarch of a wealthy and powerful family s ...
 [4] &lt;p class="text-muted"&gt;\nA hiker finds shelter in a mountain lodge inhabi ...
 [5] &lt;p class="text-muted"&gt;\nMassimo is a member of the Sicilian Mafia family ...
 [6] &lt;p class="text-muted"&gt;\nDiana must contend with a work colleague, and wi ...
 [7] &lt;p class="text-muted"&gt;\nA mother helps her daughter work through four cr ...
 [8] &lt;p class="text-muted"&gt;\nA man refuses all assistance from his daughter a ...
 [9] &lt;p class="text-muted"&gt;\nWhen Enola Holmes (Sherlock's teen sister) disco ...
[10] &lt;p class="text-muted"&gt;\nA young woman, traumatized by a tragic event in  ...
[11] &lt;p class="text-muted"&gt;\nThe real life of one of America's foremost found ...
[12] &lt;p class="text-muted"&gt;\nFollowing the events at home, the Abbott family  ...
[13] &lt;p class="text-muted"&gt;\nSinister characters converge around a young man  ...
[14] &lt;p class="text-muted"&gt;\nSeven years after he survived the monster apocal ...
[15] &lt;p class="text-muted"&gt;\nA retired sheriff and his wife, grieving over th ...
[16] &lt;p class="text-muted"&gt;\nFull of misgivings, a young woman travels with h ...
[17] &lt;p class="text-muted"&gt;\nFour high-school teachers consume alcohol on a d ...
[18] &lt;p class="text-muted"&gt;\nIn 1800s England, a well meaning but selfish you ...
[19] &lt;p class="text-muted"&gt;\nMiami detectives Mike Lowrey and Marcus Burnett  ...
[20] &lt;p class="text-muted"&gt;\nAfter swapping bodies with a deranged serial kil ...
...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting the description data to text</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>description_data <span class="ot">&lt;-</span> <span class="fu">html_text</span>(description_data_html)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look at first few</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(description_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "\nArmed with only one word, Tenet, and fighting for the survival of the entire world, a Protagonist journeys through a twilight world of international espionage on a mission that will unfold in something beyond real time."          
[2] "\nAn agent works for a secretive organization that uses brain-implant technology to inhabit other people's bodies - ultimately driving them to commit assassinations for high-paying clients."                                          
[3] "\nThe patriarch of a wealthy and powerful family suddenly passes away, leaving his daughter with a shocking secret inheritance that threatens to unravel and destroy the family."                                                       
[4] "\nA hiker finds shelter in a mountain lodge inhabited by two strange women."                                                                                                                                                            
[5] "\nMassimo is a member of the Sicilian Mafia family and Laura is a sales director. She does not expect that on a trip to Sicily trying to save her relationship, Massimo will kidnap her and give her 365 days to fall in love with him."
[6] "\nDiana must contend with a work colleague, and with a businessman whose desire for extreme wealth sends the world down a path of destruction, after an ancient artifact that grants wishes goes missing."                              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># strip the '\n'</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>description_data <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(description_data, <span class="st">"^</span><span class="sc">\\</span><span class="st">n"</span>, <span class="st">""</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(description_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Armed with only one word, Tenet, and fighting for the survival of the entire world, a Protagonist journeys through a twilight world of international espionage on a mission that will unfold in something beyond real time."          
[2] "An agent works for a secretive organization that uses brain-implant technology to inhabit other people's bodies - ultimately driving them to commit assassinations for high-paying clients."                                          
[3] "The patriarch of a wealthy and powerful family suddenly passes away, leaving his daughter with a shocking secret inheritance that threatens to unravel and destroy the family."                                                       
[4] "A hiker finds shelter in a mountain lodge inhabited by two strange women."                                                                                                                                                            
[5] "Massimo is a member of the Sicilian Mafia family and Laura is a sales director. She does not expect that on a trip to Sicily trying to save her relationship, Massimo will kidnap her and give her 365 days to fall in love with him."
[6] "Diana must contend with a work colleague, and with a businessman whose desire for extreme wealth sends the world down a path of destruction, after an ancient artifact that grants wishes goes missing."                              </code></pre>
</div>
</div>
</section>
<section id="runtime" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="runtime"><span class="header-section-number">3.4</span> Runtime</h3>
<ul>
<li>Retrieve runtime data</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using CSS selectors to scrap the Movie runtime section</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>(runtime_data <span class="ot">&lt;-</span> webpage <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">'.runtime'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">" min"</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.integer</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 150 103 111  89 114 151 100  97 123 113 160  97 138 109 113 134 117 124
 [19] 124 102 109 124 107  90 117 116 100 105 125  96 101 119  90 118  96 115
 [37]  95  91 104 137 126  90 107  99  88 100 124 112  93  94 103 100 123 102
 [55] 136  95  90 129 118  97 100  90 131 113  95  93 103 111  77  90 112 123
 [73] 100 106  95 115 117 102  98  57 101  84 103  91 101 116 118 107  95  92
 [91] 104 109 120  88 104 104  98  97  96 116</code></pre>
</div>
</div>
</section>
<section id="genre" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="genre"><span class="header-section-number">3.5</span> Genre</h3>
<ul>
<li>Collect the (first) genre of each movie:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>genre_data <span class="ot">&lt;-</span> webpage <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Using CSS selectors to scrap the Movie genre section</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">'.genre'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Converting the genre data to text</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data-Preprocessing: retrieve the first word</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_extract</span>(<span class="st">"[:alpha:]+"</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>genre_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "Action"    "Horror"    "Drama"     "Thriller"  "Drama"     "Action"   
  [7] "Drama"     "Drama"     "Action"    "Crime"     "Biography" "Drama"    
 [13] "Crime"     "Action"    "Crime"     "Drama"     "Comedy"    "Comedy"   
 [19] "Action"    "Comedy"    "Action"    "Drama"     "Drama"     "Comedy"   
 [25] "Crime"     "Action"    "Animation" "Drama"     "Action"    "Drama"    
 [31] "Comedy"    "Action"    "Action"    "Adventure" "Action"    "Action"   
 [37] "Action"    "Action"    "Comedy"    "Drama"     "Drama"     "Mystery"  
 [43] "Horror"    "Action"    "Drama"     "Action"    "Drama"     "Drama"    
 [49] "Horror"    "Action"    "Action"    "Crime"     "Comedy"    "Comedy"   
 [55] "Comedy"    "Action"    "Comedy"    "Drama"     "Comedy"    "Drama"    
 [61] "Action"    "Action"    "Biography" "Action"    "Animation" "Action"   
 [67] "Comedy"    "Action"    "Comedy"    "Biography" "Crime"     "Drama"    
 [73] "Adventure" "Adventure" "Biography" "Drama"     "Animation" "Animation"
 [79] "Drama"     "Horror"    "Adventure" "Drama"     "Comedy"    "Animation"
 [85] "Drama"     "Action"    "Action"    "Drama"     "Comedy"    "Action"   
 [91] "Horror"    "Fantasy"   "Biography" "Comedy"    "Comedy"    "Comedy"   
 [97] "Action"    "Drama"     "Drama"     "Drama"    </code></pre>
</div>
</div>
</section>
<section id="rating" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="rating"><span class="header-section-number">3.6</span> Rating</h3>
<ul>
<li>Rating data:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>rating_data <span class="ot">&lt;-</span> webpage <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">'.ratings-imdb-rating strong'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>rating_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 7.3 6.5 5.5 4.0 3.3 5.4 6.5 8.2 6.6 7.5 8.4 7.2 7.1 6.9 6.7 6.6 7.7 6.7
 [19] 6.5 6.3 6.0 7.1 7.3 7.4 6.8 6.7 8.0 5.0 6.6 5.7 5.8 6.4 6.5 5.6 5.4 5.7
 [37] 5.8 7.0 6.5 6.2 7.0 6.7 6.5 6.5 5.7 4.7 7.1 7.2 5.4 5.3 5.2 5.7 6.5 5.7
 [55] 7.1 4.8 5.7 7.7 6.3 4.5 6.8 6.0 6.8 6.0 6.9 5.9 5.2 6.2 7.1 6.8 7.1 6.0
 [73] 6.7 5.3 6.9 7.4 8.2 7.4 6.2 6.5 5.6 4.8 5.2 6.1 6.3 7.5 6.8 6.5 6.6 4.8
 [91] 5.4 4.9 6.5 6.1 6.1 5.7 6.3 4.7 7.4 6.7</code></pre>
</div>
</div>
</section>
<section id="votes" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="votes"><span class="header-section-number">3.7</span> Votes</h3>
<ul>
<li>Vote data</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>votes_data <span class="ot">&lt;-</span> webpage <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">'.sort-num_votes-visible span:nth-child(2)'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">","</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>votes_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 515425  38484  16669    270  91521 272130   8216 159222 197888 178164
 [11]  97419 236658 138528 130853  29385  89871 165477  56277 163595  61469
 [21] 243319  31970 164952 163391  28166 207534 335657  33276 168780  14917
 [31]  43582 120169 117063  84774  57692 150276  85413 100124  13410  31586
 [41]  51283  82654  56597 142831  33620  15439 232274  64133  22518  81963
 [51]  61108  77053  95939  10145  70496  14083  41011 180338 135051  14452
 [61]  70218  70392  76910  90833  45666  17712   7130  90552  23467    913
 [71]  34872  43281  51124  42567  10111  83844  60356 153004  21930  32238
 [81]  66085  10624  52399  24390   6262  52919  88678  33393 143285   9983
 [91]   5014  53974  19400    765  70129   9729  41606   4742   4803  43294</code></pre>
</div>
</div>
</section>
<section id="director" class="level3" data-number="3.8">
<h3 data-number="3.8" class="anchored" data-anchor-id="director"><span class="header-section-number">3.8</span> Director</h3>
<ul>
<li>Director information</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>directors_data <span class="ot">&lt;-</span> webpage <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">'.text-muted+ p a:nth-child(1)'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>directors_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "Christopher Nolan"           "Brandon Cronenberg"         
  [3] "Vaughn Stein"                "Silvio Nacucchi"            
  [5] "Barbara Bialowas"            "Patty Jenkins"              
  [7] "Rodrigo García"              "Florian Zeller"             
  [9] "Harry Bradbeer"              "Emerald Fennell"            
 [11] "Thomas Kail"                 "John Krasinski"             
 [13] "Antonio Campos"              "Michael Matthews"           
 [15] "Thomas Bezucha"              "Charlie Kaufman"            
 [17] "Thomas Vinterberg"           "Autumn de Wilde"            
 [19] "Adil El Arbi"                "Christopher Landon"         
 [21] "Cathy Yan"                   "Matthijs van Heijningen Jr."
 [23] "Chloé Zhao"                  "Max Barbakow"               
 [25] "Robert Connolly"             "Sam Hargrave"               
 [27] "Pete Docter"                 "Roger Kumble"               
 [29] "Gina Prince-Bythewood"       "Jacob Chase"                
 [31] "McG"                         "Ric Roman Waugh"            
 [33] "Craig Zobel"                 "George Clooney"             
 [35] "Tate Taylor"                 "Niki Caro"                  
 [37] "William Eubank"              "Aaron Schneider"            
 [39] "Lawrence Michael Levine"     "David Prior"                
 [41] "Kornél Mundruczó"            "Aneesh Chaganty"            
 [43] "David Bruckner"              "Jeff Fowler"                
 [45] "Dave Franco"                 "Robert Rodriguez"           
 [47] "Leigh Whannell"              "Dominic Cooke"              
 [49] "David Koepp"                 "Josh Boone"                 
 [51] "Paul W.S. Anderson"          "Joe Wright"                 
 [53] "David Dobkin"                "John Patrick Shanley"       
 [55] "Judd Apatow"                 "David Ayer"                 
 [57] "Tyler Spindel"               "Aaron Sorkin"               
 [59] "J Blakeson"                  "Zoe Lister-Jones"           
 [61] "Joe Carnahan"                "Derrick Borte"              
 [63] "David Fincher"               "Henry Joost"                
 [65] "Joel Crawford"               "Jonathan Milott"            
 [67] "Michael Duggan"              "Peter Berg"                 
 [69] "Emma Seligman"               "Steve Crowhurst"            
 [71] "Chung-Hyun Lee"              "Ben Wheatley"               
 [73] "Chris Sanders"               "Robert Zemeckis"            
 [75] "Roger Michell"               "Lee Isaac Chung"            
 [77] "Haruo Sotozaki"              "Dan Scanlon"                
 [79] "John Hyams"                  "Rob Savage"                 
 [81] "Stephen Gaghan"              "Adam Mason"                 
 [83] "Steven Brill"                "Walt Dohrn"                 
 [85] "Lance Hool"                  "Anders Thomas Jensen"       
 [87] "Paul Greengrass"             "Brett Haley"                
 [89] "Jason Woliner"               "Mikael Marcimain"           
 [91] "Shana Feste"                 "Jeff Wadlow"                
 [93] "Francis Lee"                 "Scott Abramovitch"          
 [95] "John Whitesell"              "George Gallo"               
 [97] "Il Cho"                      "William Olsson"             
 [99] "Uberto Pasolini"             "Ron Howard"                 </code></pre>
</div>
</div>
</section>
<section id="actor" class="level3" data-number="3.9">
<h3 data-number="3.9" class="anchored" data-anchor-id="actor"><span class="header-section-number">3.9</span> Actor</h3>
<ul>
<li>Only the first actor</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>actors_data <span class="ot">&lt;-</span> webpage <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">'.lister-item-content .ghost+ a'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>actors_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "John David Washington" "Andrea Riseborough"    "Lily Collins"         
  [4] "Sadie Katz"            "Anna-Maria Sieklucka"  "Gal Gadot"            
  [7] "Mila Kunis"            "Anthony Hopkins"       "Millie Bobby Brown"   
 [10] "Carey Mulligan"        "Lin-Manuel Miranda"    "Emily Blunt"          
 [13] "Bill Skarsgård"        "Dylan O'Brien"         "Diane Lane"           
 [16] "Jesse Plemons"         "Mads Mikkelsen"        "Anya Taylor-Joy"      
 [19] "Will Smith"            "Vince Vaughn"          "Margot Robbie"        
 [22] "Gijs Blom"             "Frances McDormand"     "Andy Samberg"         
 [25] "Eric Bana"             "Chris Hemsworth"       "Jamie Foxx"           
 [28] "Josephine Langford"    "Charlize Theron"       "Azhy Robertson"       
 [31] "Judah Lewis"           "Gerard Butler"         "Betty Gilpin"         
 [34] "George Clooney"        "Jessica Chastain"      "Liu Yifei"            
 [37] "Kristen Stewart"       "Tom Hanks"             "Aubrey Plaza"         
 [40] "James Badge Dale"      "Vanessa Kirby"         "Sarah Paulson"        
 [43] "Rebecca Hall"          "Ben Schwartz"          "Dan Stevens"          
 [46] "YaYa Gosselin"         "Elisabeth Moss"        "Benedict Cumberbatch" 
 [49] "Kevin Bacon"           "Maisie Williams"       "Milla Jovovich"       
 [52] "Amy Adams"             "Will Ferrell"          "Emily Blunt"          
 [55] "Pete Davidson"         "Bobby Soto"            "David Spade"          
 [58] "Eddie Redmayne"        "Rosamund Pike"         "Cailee Spaeny"        
 [61] "Frank Grillo"          "Russell Crowe"         "Gary Oldman"          
 [64] "Jamie Foxx"            "Nicolas Cage"          "Lulu Wilson"          
 [67] "Eli Brown"             "Mark Wahlberg"         "Rachel Sennott"       
 [70] "Daniel Adegboyega"     "Park Shin-Hye"         "Lily James"           
 [73] "Harrison Ford"         "Anne Hathaway"         "Jim Broadbent"        
 [76] "Steven Yeun"           "Natsuki Hanae"         "Tom Holland"          
 [79] "Jules Willcox"         "Haley Bishop"          "Robert Downey Jr."    
 [82] "K.J. Apa"              "Adam Sandler"          "Anna Kendrick"        
 [85] "Jacob Elordi"          "Mads Mikkelsen"        "Tom Hanks"            
 [88] "Elle Fanning"          "Sacha Baron Cohen"     "Allison Williams"     
 [91] "Ella Balinska"         "Michael Peña"          "Kate Winslet"         
 [94] "Tony Hale"             "Emma Roberts"          "Robert De Niro"       
 [97] "Yoo Ah-in"             "Alexandra Daddario"    "James Norton"         
[100] "Amy Adams"            </code></pre>
</div>
</div>
</section>
<section id="metascore" class="level3" data-number="3.10">
<h3 data-number="3.10" class="anchored" data-anchor-id="metascore"><span class="header-section-number">3.10</span> Metascore</h3>
<ul>
<li><p>We encounter the issue of missing data when scraping metascore.</p></li>
<li><p>We see there are only 90 meta scores. 10 movies don’t have meta scores. We may manually find which movies don’t have meta scores but that’s tedious and not reproducible.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using CSS selectors to scrap the metascore section</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>ms_data_html <span class="ot">&lt;-</span> <span class="fu">html_nodes</span>(webpage, <span class="st">'.metascore'</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting the runtime data to text</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>ms_data <span class="ot">&lt;-</span> <span class="fu">html_text</span>(ms_data_html)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's have a look at the metascore </span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>ms_data <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(ms_data, <span class="st">"</span><span class="sc">\\</span><span class="st">s*$"</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>ms_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 69 72 31 60 52 88 68 73 89 71 55 63 63 78 79 71 59 67 60 91 83 69 56 83 14
[26] 70 58 22 64 50 58 39 66 48 64 79 66 67 68 47 62 51 72 65 46 43 47 41 50 42
[51] 67 22 33 76 66 54 56 40 79 51 56 54 49 79 46 48 47 74 89 72 61 70 73 26 27
[76] 53 51 29 81 73 61 68 51 22 72 40 44 57 38</code></pre>
</div>
</div>
<ul>
<li>First let’s tally index and corresponding metascore (if present).</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>rank_and_metascore <span class="ot">&lt;-</span> webpage <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">'.unfavorable , .text-primary , .favorable , .mixed'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s*$"</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "1."   "69"   "2."   "72"   "3."   "31"   "4."   "5."   "6."   "60"  
 [11] "7."   "52"   "8."   "88"   "9."   "68"   "10."  "73"   "11."  "89"  
 [21] "12."  "71"   "13."  "55"   "14."  "63"   "15."  "63"   "16."  "78"  
 [31] "17."  "79"   "18."  "71"   "19."  "59"   "20."  "67"   "21."  "60"  
 [41] "22."  "23."  "91"   "24."  "83"   "25."  "69"   "26."  "56"   "27." 
 [51] "83"   "28."  "14"   "29."  "70"   "30."  "58"   "31."  "22"   "32." 
 [61] "64"   "33."  "50"   "34."  "58"   "35."  "39"   "36."  "66"   "37." 
 [71] "48"   "38."  "64"   "39."  "79"   "40."  "41."  "66"   "42."  "67"  
 [81] "43."  "68"   "44."  "47"   "45."  "62"   "46."  "51"   "47."  "72"  
 [91] "48."  "65"   "49."  "46"   "50."  "43"   "51."  "47"   "52."  "41"  
[101] "53."  "50"   "54."  "42"   "55."  "67"   "56."  "22"   "57."  "33"  
[111] "58."  "76"   "59."  "66"   "60."  "54"   "61."  "56"   "62."  "40"  
[121] "63."  "79"   "64."  "51"   "65."  "56"   "66."  "54"   "67."  "68." 
[131] "49"   "69."  "79"   "70."  "71."  "72."  "46"   "73."  "48"   "74." 
[141] "47"   "75."  "74"   "76."  "89"   "77."  "72"   "78."  "61"   "79." 
[151] "70"   "80."  "73"   "81."  "26"   "82."  "27"   "83."  "53"   "84." 
[161] "51"   "85."  "29"   "86."  "81"   "87."  "73"   "88."  "61"   "89." 
[171] "68"   "90."  "91."  "51"   "92."  "22"   "93."  "72"   "94."  "40"  
[181] "95."  "44"   "96."  "97."  "98."  "57"   "99."  "100." "38"  </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>isrank <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(rank_and_metascore, <span class="st">"</span><span class="sc">\\</span><span class="st">.$"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>ismissing <span class="ot">&lt;-</span> isrank[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(rank_and_metascore) <span class="sc">-</span> <span class="dv">1</span>)] <span class="sc">&amp;</span> isrank[<span class="dv">2</span><span class="sc">:</span>(<span class="fu">length</span>(rank_and_metascore))]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>ismissing[<span class="fu">length</span>(ismissing) <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> isrank[<span class="fu">length</span>(isrank)]</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>missingpos <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(rank_and_metascore[ismissing])</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>metascore_data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">100</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>metascore_data[<span class="sc">-</span>missingpos] <span class="ot">&lt;-</span> ms_data</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>metascore_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 69 72 31 NA NA 60 52 88 68 73 89 71 55 63 63 78 79 71 59 67 60 NA 91 83 69
 [26] 56 83 14 70 58 22 64 50 58 39 66 48 64 79 NA 66 67 68 47 62 51 72 65 46 43
 [51] 47 41 50 42 67 22 33 76 66 54 56 40 79 51 56 54 NA 49 79 NA NA 46 48 47 74
 [76] 89 72 61 70 73 26 27 53 51 29 81 73 61 68 NA 51 22 72 40 44 NA NA 57 NA 38</code></pre>
</div>
</div>
</section>
<section id="gross" class="level3" data-number="3.11">
<h3 data-number="3.11" class="anchored" data-anchor-id="gross"><span class="header-section-number">3.11</span> Gross</h3>
<ul>
<li>Be careful with missing data.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using CSS selectors to scrap the gross revenue section</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>gross_data_html <span class="ot">&lt;-</span> <span class="fu">html_nodes</span>(webpage,<span class="st">'.ghost~ .text-muted+ span'</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting the gross revenue data to text</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>gross_data <span class="ot">&lt;-</span> <span class="fu">html_text</span>(gross_data_html)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's have a look at the gross data</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>gross_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "$58.46M"  "$46.37M"  "$160.07M" "$1.07M"   "$206.31M" "$84.16M" 
 [7] "$2.39M"   "$0.50M"   "$17.29M"  "$148.97M" "$70.41M"  "$15.16M" 
[13] "$58.57M"  "$62.34M"  "$47.70M"  "$61.56M"  "$77.05M"  "$27.31M" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data-Preprocessing: removing '$' and 'M' signs</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>gross_data <span class="ot">&lt;-</span> gross_data <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">"M"</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_sub</span>(<span class="dv">2</span>, <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's check the length of gross data</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>gross_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  58.46  46.37 160.07   1.07 206.31  84.16   2.39   0.50  17.29 148.97
[11]  70.41  15.16  58.57  62.34  47.70  61.56  77.05  27.31</code></pre>
</div>
</div>
<p>82 (out of 100) movies don’t have gross data yet! We need a better way to figure out missing entries.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>(rank_and_gross <span class="ot">&lt;-</span> webpage <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>   <span class="co"># retrieve rank and gross</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">html_nodes</span>(<span class="st">'.ghost~ .text-muted+ span , .text-primary'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">html_text</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_replace</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_replace_all</span>(<span class="st">"[$M]"</span>, <span class="st">""</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "1."     "58.46"  "2."     "3."     "4."     "5."     "6."     "46.37" 
  [9] "7."     "8."     "9."     "10."    "11."    "12."    "160.07" "13."   
 [17] "14."    "1.07"   "15."    "16."    "17."    "18."    "19."    "206.31"
 [25] "20."    "21."    "84.16"  "22."    "23."    "24."    "25."    "26."   
 [33] "27."    "28."    "2.39"   "29."    "30."    "31."    "32."    "33."   
 [41] "34."    "35."    "0.50"   "36."    "37."    "17.29"  "38."    "39."   
 [49] "40."    "41."    "42."    "43."    "44."    "148.97" "45."    "46."   
 [57] "47."    "70.41"  "48."    "49."    "50."    "51."    "15.16"  "52."   
 [65] "53."    "54."    "55."    "56."    "57."    "58."    "59."    "60."   
 [73] "61."    "62."    "63."    "64."    "65."    "58.57"  "66."    "67."   
 [81] "68."    "69."    "70."    "71."    "72."    "73."    "62.34"  "74."   
 [89] "75."    "76."    "77."    "47.70"  "78."    "61.56"  "79."    "80."   
 [97] "81."    "77.05"  "82."    "83."    "84."    "85."    "86."    "87."   
[105] "88."    "89."    "90."    "91."    "92."    "27.31"  "93."    "94."   
[113] "95."    "96."    "97."    "98."    "99."    "100."  </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>isrank <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(rank_and_gross, <span class="st">"</span><span class="sc">\\</span><span class="st">.$"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>ismissing <span class="ot">&lt;-</span> isrank[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(rank_and_gross) <span class="sc">-</span> <span class="dv">1</span>)] <span class="sc">&amp;</span> isrank[<span class="dv">2</span><span class="sc">:</span>(<span class="fu">length</span>(rank_and_gross))]</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>ismissing[<span class="fu">length</span>(ismissing)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> isrank[<span class="fu">length</span>(isrank)]</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>missingpos <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(rank_and_gross[ismissing])</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>gs_data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">100</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>gs_data[<span class="sc">-</span>missingpos] <span class="ot">&lt;-</span> gross_data</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>(gross_data <span class="ot">&lt;-</span> gs_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]  58.46     NA     NA     NA     NA  46.37     NA     NA     NA     NA
 [11]     NA 160.07     NA   1.07     NA     NA     NA     NA 206.31     NA
 [21]  84.16     NA     NA     NA     NA     NA     NA   2.39     NA     NA
 [31]     NA     NA     NA     NA   0.50     NA  17.29     NA     NA     NA
 [41]     NA     NA     NA 148.97     NA     NA  70.41     NA     NA     NA
 [51]  15.16     NA     NA     NA     NA     NA     NA     NA     NA     NA
 [61]     NA     NA     NA     NA  58.57     NA     NA     NA     NA     NA
 [71]     NA     NA  62.34     NA     NA     NA  47.70  61.56     NA     NA
 [81]  77.05     NA     NA     NA     NA     NA     NA     NA     NA     NA
 [91]     NA  27.31     NA     NA     NA     NA     NA     NA     NA     NA</code></pre>
</div>
</div>
</section>
<section id="visualizing-movie-data" class="level3" data-number="3.12">
<h3 data-number="3.12" class="anchored" data-anchor-id="visualizing-movie-data"><span class="header-section-number">3.12</span> Visualizing movie data</h3>
<ul>
<li>Form a tibble:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combining all the lists to form a data frame</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>movies <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Rank =</span> rank_data, </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Title =</span> title_data,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Description =</span> description_data, </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Runtime =</span> runtime_data,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Genre =</span> genre_data, </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Rating =</span> rating_data,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Metascore =</span> metascore_data, </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Votes =</span> votes_data,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Gross_Earning_in_Mil =</span> gross_data,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Director =</span> directors_data, </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Actor =</span> actors_data)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>movies <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">width=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 11
    Rank Title                
   &lt;int&gt; &lt;chr&gt;                
 1     1 Tenet                
 2     2 Possessor            
 3     3 Inheritance          
 4     4 Megan                
 5     5 365 Days             
 6     6 Wonder Woman 1984    
 7     7 Four Good Days       
 8     8 The Father           
 9     9 Enola Holmes         
10    10 Promising Young Woman
   Description                                                                  
   &lt;chr&gt;                                                                        
 1 Armed with only one word, Tenet, and fighting for the survival of the entire…
 2 An agent works for a secretive organization that uses brain-implant technolo…
 3 The patriarch of a wealthy and powerful family suddenly passes away, leaving…
 4 A hiker finds shelter in a mountain lodge inhabited by two strange women.    
 5 Massimo is a member of the Sicilian Mafia family and Laura is a sales direct…
 6 Diana must contend with a work colleague, and with a businessman whose desir…
 7 A mother helps her daughter work through four crucial days of recovery from …
 8 A man refuses all assistance from his daughter as he ages. As he tries to ma…
 9 When Enola Holmes (Sherlock's teen sister) discovers her mother is missing, …
10 A young woman, traumatized by a tragic event in her past, seeks out vengeanc…
   Runtime Genre    Rating Metascore  Votes Gross_Earning_in_Mil
     &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;                &lt;dbl&gt;
 1     150 Action      7.3        69 515425                 58.5
 2     103 Horror      6.5        72  38484                 NA  
 3     111 Drama       5.5        31  16669                 NA  
 4      89 Thriller    4          NA    270                 NA  
 5     114 Drama       3.3        NA  91521                 NA  
 6     151 Action      5.4        60 272130                 46.4
 7     100 Drama       6.5        52   8216                 NA  
 8      97 Drama       8.2        88 159222                 NA  
 9     123 Action      6.6        68 197888                 NA  
10     113 Crime       7.5        73 178164                 NA  
   Director           Actor                
   &lt;chr&gt;              &lt;chr&gt;                
 1 Christopher Nolan  John David Washington
 2 Brandon Cronenberg Andrea Riseborough   
 3 Vaughn Stein       Lily Collins         
 4 Silvio Nacucchi    Sadie Katz           
 5 Barbara Bialowas   Anna-Maria Sieklucka 
 6 Patty Jenkins      Gal Gadot            
 7 Rodrigo García     Mila Kunis           
 8 Florian Zeller     Anthony Hopkins      
 9 Harry Bradbeer     Millie Bobby Brown   
10 Emerald Fennell    Carey Mulligan       
# … with 90 more rows</code></pre>
</div>
</div>
<ul>
<li>How many top 100 movies are in each genre? (Be careful with interpretation.)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>movies <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Genre))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="scraping_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Which genre is most profitable in terms of average gross earnings?</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>movies <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Genre) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_earning =</span> <span class="fu">mean</span>(Gross_Earning_in_Mil, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Genre, <span class="at">y =</span> avg_earning)) <span class="sc">+</span> </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"avg earning in millions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 rows containing missing values (`position_stack()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="scraping_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> movies) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Genre, <span class="at">y =</span> Gross_Earning_in_Mil)) <span class="sc">+</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Gross earning in millions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 82 rows containing non-finite values (`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="scraping_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Is there a relationship between gross earning and rating? Find the best selling movie (by gross earning) in each genre</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggrepel"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>(best_in_genre <span class="ot">&lt;-</span> movies <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Genre) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">row_number</span>(<span class="fu">desc</span>(Gross_Earning_in_Mil)) <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 11
# Groups:   Genre [5]
   Rank Title                
  &lt;int&gt; &lt;chr&gt;                
1    12 A Quiet Place Part II
2    19 Bad Boys for Life    
3    78 Onward               
4    81 Dolittle             
5    92 Fantasy Island       
  Description                                                                   
  &lt;chr&gt;                                                                         
1 Following the events at home, the Abbott family now face the terrors of the o…
2 Miami detectives Mike Lowrey and Marcus Burnett must face off against a mothe…
3 Two elven brothers embark on a quest to bring their father back for one day.  
4 A physician who can talk to animals embarks on an adventure to find a legenda…
5 When the owner and operator of a luxurious island invites a collection of gue…
  Runtime Genre     Rating Metascore  Votes Gross_Earning_in_Mil Director      
    &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;                &lt;dbl&gt; &lt;chr&gt;         
1      97 Drama        7.2        71 236658                160.  John Krasinski
2     124 Action       6.5        59 163595                206.  Adil El Arbi  
3     102 Animation    7.4        61 153004                 61.6 Dan Scanlon   
4     101 Adventure    5.6        26  66085                 77.0 Stephen Gaghan
5     109 Fantasy      4.9        22  53974                 27.3 Jeff Wadlow   
  Actor            
  &lt;chr&gt;            
1 Emily Blunt      
2 Will Smith       
3 Tom Holland      
4 Robert Downey Jr.
5 Michael Peña     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(movies, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Rating, <span class="at">y =</span> Gross_Earning_in_Mil)) <span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">size =</span> Votes, <span class="at">color =</span> Genre)) <span class="sc">+</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> Title), <span class="at">data =</span> best_in_genre) <span class="sc">+</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Gross earning in millions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 82 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="scraping_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="example-scraping-finance-data" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="example-scraping-finance-data"><span class="header-section-number">4</span> Example: Scraping finance data</h2>
<ul>
<li><code>quantmod</code> package contains many utility functions for retrieving and plotting finance data. E.g.,</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>stock <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"TSLA"</span>, <span class="at">src =</span> <span class="st">"yahoo"</span>, <span class="at">auto.assign =</span> <span class="cn">FALSE</span>, <span class="at">from =</span> <span class="st">"2020-01-01"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stock)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           TSLA.Open TSLA.High TSLA.Low TSLA.Close TSLA.Volume TSLA.Adjusted
2020-01-02  28.30000  28.71333 28.11400   28.68400   142981500      28.68400
2020-01-03  29.36667  30.26667 29.12800   29.53400   266677500      29.53400
2020-01-06  29.36467  30.10400 29.33333   30.10267   151995000      30.10267
2020-01-07  30.76000  31.44200 30.22400   31.27067   268231500      31.27067
2020-01-08  31.58000  33.23267 31.21533   32.80933   467164500      32.80933
2020-01-09  33.14000  33.25333 31.52467   32.08933   426606000      32.08933</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chartSeries</span>(stock, <span class="at">theme =</span> <span class="fu">chartTheme</span>(<span class="st">"white"</span>),</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">"line"</span>, <span class="at">log.scale =</span> <span class="cn">FALSE</span>, <span class="at">TA =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="scraping_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="example-pull-tweets-into-r" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="example-pull-tweets-into-r"><span class="header-section-number">5</span> Example: Pull tweets into R</h2>
<ul>
<li><p>Read blog: <a href="https://towardsdatascience.com/pulling-tweets-into-r-e17d4981cfe2" class="uri">https://towardsdatascience.com/pulling-tweets-into-r-e17d4981cfe2</a></p></li>
<li><p><a href="https://www.rdocumentation.org/packages/twitteR"><code>twitteR</code> package</a> is useful for pulling tweets text data into R.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(twitteR) <span class="co">#load package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Step 1: apply for a <a href="https://developer.twitter.com">Twitter developer account</a>. It takes some time to get approved.</p></li>
<li><p>Step 2: Generate and copy the Twitter App Keys.</p></li>
</ul>
<pre><code>consumer_key &lt;- 'XXXXXXXXXX'
consumer_secret &lt;- 'XXXXXXXXXX'
access_token &lt;- 'XXXXXXXXXX'
access_secret &lt;- 'XXXXXXXXXX'</code></pre>
<ul>
<li>Step 3. Set up authentication</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setup_twitter_oauth</span>(consumer_key, consumer_secret, access_token, access_secret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Step 4: Pull tweets</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>virus <span class="ot">&lt;-</span> <span class="fu">searchTwitter</span>(<span class="st">'#China + #Coronavirus'</span>, </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n =</span> <span class="dv">1000</span>, </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">since =</span> <span class="st">'2020-01-01'</span>, </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">retryOnRateLimit =</span> <span class="fl">1e3</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>virus_df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">twListToDF</span>(virus))</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>virus_df <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>